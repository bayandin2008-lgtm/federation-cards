<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–§–µ–¥–µ—Ä–∞—Ü–∏—è –≤–æ–∑–¥—É—à–Ω–æ-—Å–∏–ª–æ–≤–æ–π –∞—Ç–ª–µ—Ç–∏–∫–∏</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .athlete-card {
            border: 2px solid #333;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            background: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .loading {
            text-align: center;
            font-size: 1.2em;
            color: #666;
            padding: 40px;
        }
        .error {
            background: #ffe6e6;
            border: 1px solid #ffcccc;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>üèÜ –§–µ–¥–µ—Ä–∞—Ü–∏—è –≤–æ–∑–¥—É—à–Ω–æ-—Å–∏–ª–æ–≤–æ–π –∞—Ç–ª–µ—Ç–∏–∫–∏</h1>
    <div id="athlete-info">
        <p class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–∞...</p>
    </div>

    <script>
        // ID –≤–∞—à–µ–π Google —Ç–∞–±–ª–∏—Ü—ã
        const SPREADSHEET_ID = '1i0XJEl3JkX1rB5StPxcpjMXcF31Le5PUhpVc5T8en8E';
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è ID —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–∞ –∏–∑ URL
        function getAthleteId() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('id') || '1';
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Å —Ç–∞–π–º–∞—É—Ç–æ–º
        function loadAthleteData() {
            const athleteId = getAthleteId();
            const timeout = 10000; // 10 —Å–µ–∫—É–Ω–¥ —Ç–∞–π–º–∞—É—Ç
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–∞—É—Ç
            const timeoutPromise = new Promise((_, reject) => {
                setTimeout(() => reject(new Error('–¢–∞–π–º–∞—É—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö')), timeout);
            });
            
            // –ó–∞–ø—Ä–æ—Å –∫ –¥–∞–Ω–Ω—ã–º
            const dataPromise = fetchDataFromSheet();
            
            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å —Ç–∞–π–º–∞—É—Ç–æ–º
            Promise.race([dataPromise, timeoutPromise])
                .then(athletes => {
                    const athlete = athletes.find(a => a.id === athleteId);
                    if (athlete) {
                        displayAthleteData(athlete);
                    } else {
                        showError('–°–ø–æ—Ä—Ç—Å–º–µ–Ω —Å ID ' + athleteId + ' –Ω–µ –Ω–∞–π–¥–µ–Ω');
                    }
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞:', error);
                    showError('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ: ' + error.message);
                });
        }

        // –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
        async function fetchDataFromSheet() {
            // –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –ø—Ä–æ–∫—Å–∏
            const proxies = [
                'https://api.allorigins.win/raw?url=',
                'https://corsproxy.io/?',
                'https://api.codetabs.com/v1/proxy?quest='
            ];
            
            const spreadsheetUrl = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?tqx=out:csv`;
            
            for (let proxy of proxies) {
                try {
                    console.log('–ü—Ä–æ–±—É–µ–º –ø—Ä–æ–∫—Å–∏:', proxy);
                    const response = await fetch(proxy + encodeURIComponent(spreadsheetUrl));
                    
                    if (response.ok) {
                        const csvData = await response.text();
                        return parseCSV(csvData);
                    }
                } catch (error) {
                    console.log('–ü—Ä–æ–∫—Å–∏ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª:', proxy, error);
                    continue;
                }
            }
            
            throw new Error('–í—Å–µ –ø—Ä–æ–∫—Å–∏ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∏');
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ CSV
        function parseCSV(csvText) {
            const lines = csvText.split('\n').filter(line => line.trim() !== '');
            if (lines.length < 2) return [];

            const headers = lines[0].split(',').map(header => 
                header.replace(/"/g, '').trim().toLowerCase()
            );

            const athletes = [];
            
            for (let i = 1; i < lines.length; i++) {
                const values = parseCSVLine(lines[i]);
                
                if (values.length === headers.length) {
                    const athlete = {};
                    headers.forEach((header, index) => {
                        athlete[header] = values[index] || '';
                    });
                    athletes.push(athlete);
                }
            }
            
            return athletes;
        }

        // –ü–∞—Ä—Å–∏–Ω–≥ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ CSV
        function parseCSVLine(line) {
            const values = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    values.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            
            values.push(current.trim());
            return values.map(val => val.replace(/"/g, ''));
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–∞
        function displayAthleteData(data) {
            console.log('–ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:', data);
            
            const statusClass = data.–¥–æ–ø—É—Å–∫ === "‚úÖ" ? "status-approved" : "status-rejected";
            const statusText = data.–¥–æ–ø—É—Å–∫ === "‚úÖ" ? "–î–û–ü–£–°–ö –ü–û–î–¢–í–ï–†–ñ–î–ï–ù" : "–î–û–ü–£–°–ö –ó–ê–ü–†–ï–©–ï–ù";

            // –ü—Ä–æ—Å—Ç–∞—è –≤–µ—Ä—Å–∏—è –±–µ–∑ —Å–ª–æ–∂–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            const html = `
                <div class="athlete-card">
                    <h2>${data.—Ñ–∏–æ || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</h2>
                    <p><strong>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:</strong> ${data.–¥–∞—Ç–∞_—Ä–æ–∂–¥–µ–Ω–∏—è || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</p>
                    ${data.–¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ ? `<p><strong>–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞:</strong> ${data.–¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞}</p>` : ''}
                    
                    <h3>–î–æ–ø—É—Å–∫–∏ –∫ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è–º:</h3>
                    <p>–ú–µ–¥—Å–ø—Ä–∞–≤–∫–∞: ${data.—Å—Ç–∞—Ç—É—Å_–º–µ–¥—Å–ø—Ä–∞–≤–∫–∏ || '‚ùå'}</p>
                    <p>–°—Ç—Ä–∞—Ö–æ–≤–∫–∞: ${data.—Å—Ç–∞—Ç—É—Å_—Å—Ç—Ä–∞—Ö–æ–≤–∫–∏ || '‚ùå'}</p>
                    <p>–ß–ª–µ–Ω—Å–∫–∏–π –≤–∑–Ω–æ—Å: ${data.—á–ª–µ–Ω—Å–∫–∏–π_–≤–∑–Ω–æ—Å || '‚ùå'}</p>
                    
                    <div style="color: ${data.–¥–æ–ø—É—Å–∫ === "‚úÖ" ? 'green' : 'red'}; font-weight: bold; margin: 15px 0; padding: 10px; border: 2px solid ${data.–¥–æ–ø—É—Å–∫ === "‚úÖ" ? 'green' : 'red'}; border-radius: 5px; text-align: center;">
                        ${statusText}
                    </div>
                    
                    <h3>–°–ø–æ—Ä—Ç–∏–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</h3>
                    <p>–†–µ–π—Ç–∏–Ω–≥: ${data.—Ä–µ–π—Ç–∏–Ω–≥ || '–ù–µ —É–∫–∞–∑–∞–Ω'}</p>
                    <p>–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è: ${data.–¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è || '–ù–µ—Ç'}</p>
                    <p>–≠–ª–µ–º–µ–Ω—Ç—ã: ${data.—ç–ª–µ–º–µ–Ω—Ç—ã || '–ù–µ—Ç'}</p>
                    <p>–¢–µ–ª–µ—Ñ–æ–Ω: ${data.—Ç–µ–ª–µ—Ñ–æ–Ω || '–ù–µ —É–∫–∞–∑–∞–Ω'}</p>
                </div>
            `;

            document.getElementById('athlete-info').innerHTML = html;
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –æ—à–∏–±–∫–∏
        function showError(message) {
            document.getElementById('athlete-info').innerHTML = `
                <div class="error">
                    <h3>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h3>
                    <p>${message}</p>
                    <p><small>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É</small></p>
                </div>
            `;
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = loadAthleteData;
    </script>
</body>
</html>
