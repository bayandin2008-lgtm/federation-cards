<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–§–µ–¥–µ—Ä–∞—Ü–∏—è –≤–æ–∑–¥—É—à–Ω–æ-—Å–∏–ª–æ–≤–æ–π –∞—Ç–ª–µ—Ç–∏–∫–∏</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .athlete-card {
            border: 2px solid #333;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            background: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .loading {
            text-align: center;
            font-size: 1.2em;
            color: #666;
            padding: 40px;
        }
        .error {
            background: #ffe6e6;
            border: 1px solid #ffcccc;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>üèÜ –§–µ–¥–µ—Ä–∞—Ü–∏—è –≤–æ–∑–¥—É—à–Ω–æ-—Å–∏–ª–æ–≤–æ–π –∞—Ç–ª–µ—Ç–∏–∫–∏</h1>
    <div id="athlete-info">
        <p class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–∞...</p>
    </div>

    <script>
        // ID –≤–∞—à–µ–π Google —Ç–∞–±–ª–∏—Ü—ã
        const SPREADSHEET_ID = '1i0XJEl3JkX1rB5StPxcpjMXcF31Le5PUhpVc5T8en8E';
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è ID —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–∞ –∏–∑ URL
        function getAthleteId() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('id') || '1';
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
        async function loadAthleteData() {
            const athleteId = getAthleteId();
            
            try {
                // –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
                const athletes = await tryAllDataSources();
                const athlete = athletes.find(a => a.id === athleteId);

                if (athlete) {
                    displayAthleteData(athlete);
                } else {
                    showError('–°–ø–æ—Ä—Ç—Å–º–µ–Ω —Å ID ' + athleteId + ' –Ω–µ –Ω–∞–π–¥–µ–Ω');
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –∫–∞–∫ –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç
                showStaticData();
            }
        }

        // –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö
        async function tryAllDataSources() {
            const dataSources = [
                tryDirectCSV(),
                tryCorsProxy(),
                tryJsonEndpoint()
            ];

            for (let source of dataSources) {
                try {
                    const result = await source;
                    if (result && result.length > 0) {
                        console.log('–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑:', source.name);
                        return result;
                    }
                } catch (error) {
                    console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —á–µ—Ä–µ–∑:', source.name, error);
                    continue;
                }
            }
            
            throw new Error('–í—Å–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã');
        }

        // –ü—Ä—è–º–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ CSV (–º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –∏–∑-–∑–∞ CORS)
        async function tryDirectCSV() {
            const url = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?tqx=out:csv`;
            const response = await fetch(url);
            const csvData = await response.text();
            return parseCSV(csvData);
        }

        // –ß–µ—Ä–µ–∑ CORS –ø—Ä–æ–∫—Å–∏
        async function tryCorsProxy() {
            const proxies = [
                'https://corsproxy.io/?',
                'https://api.codetabs.com/v1/proxy?quest=',
                'https://cors-anywhere.herokuapp.com/'
            ];
            
            const spreadsheetUrl = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?tqx=out:csv`;
            
            for (let proxy of proxies) {
                try {
                    const response = await fetch(proxy + encodeURIComponent(spreadsheetUrl), {
                        timeout: 5000
                    });
                    
                    if (response.ok) {
                        const csvData = await response.text();
                        return parseCSV(csvData);
                    }
                } catch (error) {
                    continue;
                }
            }
            throw new Error('–í—Å–µ –ø—Ä–æ–∫—Å–∏ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∏');
        }

        // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π JSON endpoint
        async function tryJsonEndpoint() {
            const url = `https://opensheet.elk.sh/${SPREADSHEET_ID}/1`;
            const response = await fetch(url);
            const jsonData = await response.json();
            return jsonData;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ CSV
        function parseCSV(csvText) {
            const lines = csvText.split('\n').filter(line => line.trim() !== '');
            if (lines.length < 2) return [];

            const headers = lines[0].split(',').map(header => 
                header.replace(/"/g, '').trim().toLowerCase()
            );

            const athletes = [];
            
            for (let i = 1; i < lines.length; i++) {
                const values = parseCSVLine(lines[i]);
                
                if (values.length === headers.length) {
                    const athlete = {};
                    headers.forEach((header, index) => {
                        athlete[header] = values[index] || '';
                    });
                    athletes.push(athlete);
                }
            }
            
            return athletes;
        }

        // –ü–∞—Ä—Å–∏–Ω–≥ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ CSV
        function parseCSVLine(line) {
            const values = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    values.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            
            values.push(current.trim());
            return values.map(val => val.replace(/"/g, ''));
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–∞
        function displayAthleteData(data) {
            console.log('–ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:', data);
            
            const statusClass = data.–¥–æ–ø—É—Å–∫ === "‚úÖ" ? "status-approved" : "status-rejected";
            const statusText = data.–¥–æ–ø—É—Å–∫ === "‚úÖ" ? "–î–û–ü–£–°–ö –ü–û–î–¢–í–ï–†–ñ–î–ï–ù" : "–î–û–ü–£–°–ö –ó–ê–ü–†–ï–©–ï–ù";

            const html = `
                <div class="athlete-card">
                    <h2>${data.—Ñ–∏–æ || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</h2>
                    <p><strong>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:</strong> ${data.–¥–∞—Ç–∞_—Ä–æ–∂–¥–µ–Ω–∏—è || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</p>
                    ${data.–¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ ? `<p><strong>–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞:</strong> ${data.–¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞}</p>` : ''}
                    
                    <h3>–î–æ–ø—É—Å–∫–∏ –∫ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏—è–º:</h3>
                    <p>–ú–µ–¥—Å–ø—Ä–∞–≤–∫–∞: ${data.—Å—Ç–∞—Ç—É—Å_–º–µ–¥—Å–ø—Ä–∞–≤–∫–∏ || '‚ùå'}</p>
                    <p>–°—Ç—Ä–∞—Ö–æ–≤–∫–∞: ${data.—Å—Ç–∞—Ç—É—Å_—Å—Ç—Ä–∞—Ö–æ–≤–∫–∏ || '‚ùå'}</p>
                    <p>–ß–ª–µ–Ω—Å–∫–∏–π –≤–∑–Ω–æ—Å: ${data.—á–ª–µ–Ω—Å–∫–∏–π_–≤–∑–Ω–æ—Å || '‚ùå'}</p>
                    
                    <div style="color: ${data.–¥–æ–ø—É—Å–∫ === "‚úÖ" ? 'green' : 'red'}; font-weight: bold; margin: 15px 0; padding: 10px; border: 2px solid ${data.–¥–æ–ø—É—Å–∫ === "‚úÖ" ? 'green' : 'red'}; border-radius: 5px; text-align: center;">
                        ${statusText}
                    </div>
                    
                    <h3>–°–ø–æ—Ä—Ç–∏–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</h3>
                    <p>–†–µ–π—Ç–∏–Ω–≥: ${data.—Ä–µ–π—Ç–∏–Ω–≥ || '–ù–µ —É–∫–∞–∑–∞–Ω'}</p>
                    <p>–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è: ${data.–¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è || '–ù–µ—Ç'}</p>
                    <p>–≠–ª–µ–º–µ–Ω—Ç—ã: ${data.—ç–ª–µ–º–µ–Ω—Ç—ã || '–ù–µ—Ç'}</p>
                    <p>–¢–µ–ª–µ—Ñ–æ–Ω: ${data.—Ç–µ–ª–µ—Ñ–æ–Ω || '–ù–µ —É–∫–∞–∑–∞–Ω'}</p>
                    
                    <div style="margin-top: 20px; padding: 10px; background: #e9ecef; border-radius: 5px;">
                        <small>ID —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–∞: ${data.id} | –û–±–Ω–æ–≤–ª–µ–Ω–æ: ${new Date().toLocaleString()}</small>
                    </div>
                </div>
            `;

            document.getElementById('athlete-info').innerHTML = html;
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –∫–∞–∫ –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç
        function showStaticData() {
            const staticData = {
                id: "1",
                —Ñ–∏–æ: "–ò–≤–∞–Ω–æ–≤ –ê–ª–µ–∫—Å–µ–π",
                –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞: "–§—Ä–∏—Å—Ç–∞–π–ª –ú–Ω–æ–≥–æ–±–æ—Ä—å–µ",
                —Ñ–æ—Ç–æ_url: "",
                —Ç–µ–ª–µ—Ñ–æ–Ω: "79991112233",
                —Å—Ç–∞—Ç—É—Å_–º–µ–¥—Å–ø—Ä–∞–≤–∫–∏: "‚úÖ",
                —Å—Ç–∞—Ç—É—Å_—Å—Ç—Ä–∞—Ö–æ–≤–∫–∏: "‚úÖ", 
                —á–ª–µ–Ω—Å–∫–∏–π_–≤–∑–Ω–æ—Å: "‚úÖ",
                —Ä–µ–π—Ç–∏–Ω–≥: "85",
                –¥–æ–ø—É—Å–∫: "‚úÖ",
                –¥–∞—Ç–∞_—Ä–æ–∂–¥–µ–Ω–∏—è: "15.03.1995",
                –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è: "–ß–µ–º–ø–∏–æ–Ω –°–∞—Ä–∞—Ç–æ–≤—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏",
                —ç–ª–µ–º–µ–Ω—Ç—ã: "–í—ã—Ö–æ–¥ —Å–∏–ª–æ–π, –≥–æ—Ä–∏–∑–æ–Ω—Ç"
            };
            
            displayAthleteData(staticData);
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
            const card = document.querySelector('.athlete-card');
            const warning = document.createElement('div');
            warning.style.background = '#fff3cd';
            warning.style.border = '1px solid #ffeaa7';
            warning.style.padding = '10px';
            warning.style.borderRadius = '5px';
            warning.style.marginTop = '10px';
            warning.innerHTML = '<strong>–í–Ω–∏–º–∞–Ω–∏–µ:</strong> –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Ç–∞–±–ª–∏—Ü–µ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ.';
            card.appendChild(warning);
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –æ—à–∏–±–∫–∏
        function showError(message) {
            document.getElementById('athlete-info').innerHTML = `
                <div class="error">
                    <h3>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h3>
                    <p>${message}</p>
                    <button onclick="location.reload()">–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É</button>
                </div>
            `;
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = loadAthleteData;
    </script>
</body>
</html>
